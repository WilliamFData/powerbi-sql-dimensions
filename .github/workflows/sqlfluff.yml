name: SQL Lint Check

on:
  workflow_dispatch:
  push:
    paths:
      - '**/*.sql'
  pull_request:
    paths:
      - '**/*.sql'

permissions:
  contents: read  # Only reading files, no write needed

jobs:
  lint-sql:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run SQLFluff Lint via Docker (Snowflake Dialect)
        run: |
          for file in $(find ${{ github.workspace }} -name "*.sql"); do
            echo "Linting $file"
            docker run --rm \
              -v "${{ github.workspace }}:/code" \
              sqlfluff/sqlfluff:latest \
              lint "/code/${file#$GITHUB_WORKSPACE/}" --dialect snowflake
          done

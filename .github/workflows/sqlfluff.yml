name: SQL Auto-Fix

on:
  workflow_dispatch:
  push:
    paths:
      - '**/*.sql'
  pull_request:
    paths:
      - '**/*.sql'

permissions:
  contents: write  # Required if you want to commit changes later

jobs:
  fix-sql:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run SQLFluff Fix via Docker (Snowflake Dialect)
      run: |
        docker run --rm \
          -v "${{ github.workspace }}:/code" \
          -u "$(id -u):$(id -g)" \
          sqlfluff/sqlfluff:latest \
          fix /code --dialect snowflake
